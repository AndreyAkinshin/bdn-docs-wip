<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Customizing Mono | BenchmarkDotNet </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Customizing Mono | BenchmarkDotNet ">
    <meta name="generator" content="docfx 2.36.1.0">
    
    <link rel="shortcut icon" href="../../logo/icon-32.png">
    <link rel="stylesheet" href="../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../styles/docfx.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <meta property="docfx:navrel" content="../../toc.html">
    <meta property="docfx:tocrel" content="../toc.html">
    
    <meta property="docfx:rel" content="../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../index.html">
                <img id="logo" class="svg" src="../../logo/icon.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="customizing-mono">Customizing Mono</h1>

<h2 id="custom-mono-paths">Custom Mono Path(s)</h2>
<p>BenchmarkDotNet allows you to compare different runtimes, including Mono. If you apply <code>[MonoJob]</code> attribute to your class we use your default mono runtime. If you want to compare different versions of Mono you need to provide use the custom paths. You can do this today by using the overloaded ctor of MonoJob attribute or by specifying the runtime in a fluent way.</p>
<h3 id="sample-configuration">Sample configuration</h3>
<pre><code class="lang-cs">[ClrJob, CoreJob]
[MonoJob(&quot;Mono 4.8.0&quot;, @&quot;C:\Program Files\Mono\bin\mono.exe&quot;)]
[MonoJob(&quot;Mono 4.6.2&quot;, @&quot;C:\Program Files (x86)\Mono\bin\mono.exe&quot;)]
public class Algo_Md5VsSha256
{
   /* benchmarks removed for brevity */
}	
</code></pre>
<pre><code class="lang-cs">private IConfig CreateConfig()
{
	return ManualConfig.CreateEmpty()
		.With(Job.ShortRun.With(new MonoRuntime(&quot;Mono 4.8.0&quot;, @&quot;C:\Program Files\Mono\bin\mono.exe&quot;))
		.With(Job.ShortRun.With(new MonoRuntime(&quot;Mono 4.6.2&quot;, @&quot;C:\Program Files (x86)\Mono\bin\mono.exe&quot;));
}
</code></pre>
<h3 id="sample-results">Sample results:</h3>
<pre><code>// ***** BenchmarkRunner: Start   *****
// Found benchmarks:
//   Algo_Md5VsSha256.Md5: Clr(Runtime=Clr)
//   Algo_Md5VsSha256.Sha256: Clr(Runtime=Clr)
//   Algo_Md5VsSha256.Md5: Core(Runtime=Core)
//   Algo_Md5VsSha256.Sha256: Core(Runtime=Core)
//   Algo_Md5VsSha256.Md5: Mono 4.6.2(Runtime=Mono 4.6.2)
//   Algo_Md5VsSha256.Sha256: Mono 4.6.2(Runtime=Mono 4.6.2)
//   Algo_Md5VsSha256.Md5: Mono 4.8.0(Runtime=Mono 4.8.0)
//   Algo_Md5VsSha256.Sha256: Mono 4.8.0(Runtime=Mono 4.8.0)
</code></pre>
<pre><code class="lang-ini">BenchmarkDotNet=v0.10.2.0-develop, OS=Microsoft Windows 10.0.14393
Processor=Intel(R) Core(TM) i7-6600U CPU 2.60GHz, ProcessorCount=4
Frequency=2742190 Hz, Resolution=364.6720 ns, Timer=TSC
dotnet cli version=1.0.0-rc4-004771
  [Host]     : .NET Core 4.6.24628.01, 64bit RyuJIT
  Clr        : Clr 4.0.30319.42000, 64bit RyuJIT-v4.6.1586.0
  Core       : .NET Core 4.6.24628.01, 64bit RyuJIT
  Mono 4.6.2 : Mono 4.6.2 (Visual Studio built mono), 32bit 
  Mono 4.8.0 : Mono 4.8.0 (Visual Studio built mono), 64bit 
</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Job</th>
<th>Runtime</th>
<th>Mean</th>
<th>StdDev</th>
<th>Median</th>
<th>Scaled</th>
<th>Scaled-StdDev</th>
<th>Allocated</th>
</tr>
</thead>
<tbody>
<tr>
<td>Md5</td>
<td>Clr</td>
<td>Clr</td>
<td>23.2459 us</td>
<td>0.9337 us</td>
<td>23.3425 us</td>
<td>1.00</td>
<td>0.00</td>
<td>112 B</td>
</tr>
<tr>
<td>Sha256</td>
<td>Clr</td>
<td>Clr</td>
<td>111.8421 us</td>
<td>2.4760 us</td>
<td>110.6653 us</td>
<td>4.82</td>
<td>0.21</td>
<td>188 B</td>
</tr>
<tr>
<td>Md5</td>
<td>Core</td>
<td>Core</td>
<td>21.4333 us</td>
<td>0.5074 us</td>
<td>21.1727 us</td>
<td>1.00</td>
<td>0.00</td>
<td>80 B</td>
</tr>
<tr>
<td>Sha256</td>
<td>Core</td>
<td>Core</td>
<td>50.1553 us</td>
<td>1.2729 us</td>
<td>49.7332 us</td>
<td>2.34</td>
<td>0.08</td>
<td>114 B</td>
</tr>
<tr>
<td>Md5</td>
<td>Mono 4.6.2</td>
<td>Mono 4.6.2</td>
<td>45.1584 us</td>
<td>1.0023 us</td>
<td>45.5757 us</td>
<td>1.00</td>
<td>0.00</td>
<td>N/A</td>
</tr>
<tr>
<td>Sha256</td>
<td>Mono 4.6.2</td>
<td>Mono 4.6.2</td>
<td>168.4400 us</td>
<td>3.7425 us</td>
<td>170.4372 us</td>
<td>3.73</td>
<td>0.11</td>
<td>N/A</td>
</tr>
<tr>
<td>Md5</td>
<td>Mono 4.8.0</td>
<td>Mono 4.8.0</td>
<td>40.4432 us</td>
<td>0.9094 us</td>
<td>40.2218 us</td>
<td>1.00</td>
<td>0.00</td>
<td>N/A</td>
</tr>
<tr>
<td>Sha256</td>
<td>Mono 4.8.0</td>
<td>Mono 4.8.0</td>
<td>155.5073 us</td>
<td>12.9351 us</td>
<td>151.4520 us</td>
<td>3.85</td>
<td>0.33</td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h2 id="mono-options">Mono Options</h2>
<p>Mono supports many custom options: <code>mono [options] program [program-options]</code> And so does the BenchmarkDotNet. You can configure the options by using <code>MonoArgument</code>.</p>
<h3 id="sample-configuration-1">Sample configuration</h3>
<pre><code class="lang-cs">[Config(typeof(ConfigWithCustomArguments))]
public class IntroCustomMonoArguments
{
    public class ConfigWithCustomArguments : ManualConfig
    {
        public ConfigWithCustomArguments()
        {
            // --optimize=MODE , -O=mode
            // MODE is a comma separated list of optimizations. They also allow
            // optimizations to be turned off by prefixing the optimization name with a minus sign.

            Add(Job.Mono.With(new[] { new MonoArgument(&quot;--optimize=inline&quot;) }).WithId(&quot;Inlining enabled&quot;));
            Add(Job.Mono.With(new[] { new MonoArgument(&quot;--optimize=-inline&quot;) }).WithId(&quot;Inlining disabled&quot;));
        }
    }

    [Benchmark]
    public void Sample()
    {
        ShouldGetInlined(); ShouldGetInlined(); ShouldGetInlined();
        ShouldGetInlined(); ShouldGetInlined(); ShouldGetInlined();
        ShouldGetInlined(); ShouldGetInlined(); ShouldGetInlined();
    }

    void ShouldGetInlined() { }
}
</code></pre>
<h3 id="sample-results-1">Sample results</h3>
<pre><code class="lang-ini">BenchmarkDotNet=v0.10.9.20170903-develop, OS=Windows 10 Redstone 1 (10.0.14393)
Processor=Intel Core i7-6600U CPU 2.60GHz (Skylake), ProcessorCount=4
Frequency=2742190 Hz, Resolution=364.6720 ns, Timer=TSC
  [Host]            : .NET Framework 4.7 (CLR 4.0.30319.42000), 64bit RyuJIT-v4.7.2101.1
  Inlining disabled : Mono 5.0.1 (Visual Studio), 32bit 
  Inlining enabled  : Mono 5.0.1 (Visual Studio), 32bit 

Runtime=Mono  
</code></pre>
<table>
<thead>
<tr>
<th>Method</th>
<th>Job</th>
<th>Arguments</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Error</th>
<th style="text-align: right;">StdDev</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sample</td>
<td>Inlining disabled</td>
<td>--optimize=-inline</td>
<td style="text-align: right;">19.4252 ns</td>
<td style="text-align: right;">0.4406 ns</td>
<td style="text-align: right;">0.4525 ns</td>
</tr>
<tr>
<td>Sample</td>
<td>Inlining enabled</td>
<td>--optimize=inline</td>
<td style="text-align: right;">0.0000 ns</td>
<td style="text-align: right;">0.0000 ns</td>
<td style="text-align: right;">0.0000 ns</td>
</tr>
</tbody>
</table>
<h2 id="llvm">LLVM</h2>
<p>To control the <code>--llvm</code> and <code>--no-llvm</code> options you need to configure Jit property. By default, LLVM is disabled (<code>--no-llvm</code>). To enable LLVM (<code>--llvm</code>) you just call <code>Job.Default.With(Jit.Llvm)</code></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/dotnet/BenchmarkDotNet/blob/master/docs/articles/features/customizing-mono.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            Copyright &copy; 2013–2018 .NET Foundation and contributors
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../styles/main.js"></script>
  </body>
</html>
